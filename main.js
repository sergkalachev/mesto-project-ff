(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-14",headers:{authorization:"0ecf087f-b21a-4f46-a88e-b66c0994f7fb","Content-Type":"application/json"}},e=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))};function n(t,e,n,r,o){var c=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),a=c.querySelector(".card__image"),i=c.querySelector(".card__like-counter"),u=c.querySelector(".card__delete-button");return a.src=t.link,a.alt=t.name,c.id=t._id,i.textContent=t.likes.length?t.likes.length:0,t.owner._id!==o.userInfoData._id&&u.classList.add("card__delete-button_hidden"),t.likes.some((function(t){return t._id===o.userInfoData._id}))&&c.querySelector(".card__like-button").classList.add("card__like-button_is-active"),c.querySelector(".card__title").textContent=t.name,c.querySelector(".card__delete-button").addEventListener("click",e),c.querySelector(".card__like-button").addEventListener("click",r),a.addEventListener("click",n),c}var r=function(n){var r=n.currentTarget.closest(".card").id,o=n.currentTarget.closest(".card");(function(n){return fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers}).then(e)})(r).then((function(){o.remove()})).catch((function(t){console.log(t)}))},o=function(n){var r,o=n.target.classList.contains("card__like-button_is-active"),c=n.target.closest(".card").querySelector(".card__like-counter");o?function(n){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:t.headers}).then(e)}(n.target.closest(".card").id).then((function(t){c.textContent=t.likes.length||0,n.target.classList.toggle("card__like-button_is-active")})).catch((function(t){console.log(t)})):(r=n.target.closest(".card").id,fetch("".concat(t.baseUrl,"/cards/likes/").concat(r),{method:"PUT",headers:t.headers}).then(e)).then((function(t){return c.textContent=t.likes.length||0,n.target.classList.toggle("card__like-button_is-active"),t})).catch((function(t){console.log(t)}))};function c(t){t.classList.toggle("popup_is-opened"),document.addEventListener("keydown",i)}function a(t){t.classList.toggle("popup_is-opened"),document.removeEventListener("keydown",i)}function i(t){if(27===t.keyCode){var e=document.querySelector(".popup_is-opened");e&&a(e)}}var u=function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},l=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},s=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(n){u(t,n,e)})),l(n,r,e.inactiveButtonClass)};function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var f=document.querySelector(".profile__edit-button"),m=document.querySelector(".popup_type_edit"),p=document.querySelector(".profile__title"),_=document.querySelector(".profile__description"),y=document.querySelector(".profile__image"),h=document.forms["update-avatar"],v=document.querySelector(".popup_type_update_avatar"),b=document.querySelector(".logo-edit__button"),g=document.forms["edit-profile"],S=g.elements.name,C=g.elements.description,k=document.querySelector(".popup_type_new-card"),q=document.querySelector(".profile__add-button"),L=document.querySelector(".places__list"),E=document.forms["new-place"],x=E.elements["place-name"],A=E.elements.link,D=document.querySelector(".popup_type_image"),w=D.querySelector(".popup__image"),U=D.querySelector(".popup__caption"),T=[D,m,k,v],j={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"form__submit_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},I={userInfoData:{},cardsData:[]},O=function(t){c(D),w.src=t.target.src,w.alt=t.target.alt,U.textContent=t.target.alt};f.addEventListener("click",(function(){S.value=p.textContent,C.value=_.textContent,s(g,j),c(m)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?u(t,e,n):function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(t,e,e.validationMessage,n)}(t,o,e),l(n,r,e)}))}))}(e,t)}))}(j),q.addEventListener("click",(function(){s(E,j),c(k),E.reset()})),T.forEach((function(t){t.querySelector(".popup__close").addEventListener("click",(function(){return a(t)}))})),document.addEventListener("click",(function(t){t.target.classList.contains("popup_is-opened")&&a(t.target)}));g.addEventListener("submit",(function(n){n.preventDefault(),function(n,r,o){n.submitter.textContent="Сохранение...",function(n,r,o){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:r.value,about:o.value})}).then(e).finally((function(){n.submitter.textContent="Сохранить"}))}(n,r,o).then((function(t){p.textContent=t.name,_.textContent=t.about,a(m)})).catch((function(t){console.log(t)})).finally((function(){n.submitter.textContent="Сохранить"}))}(n,S,C)})),E.addEventListener("submit",(function(c){c.submitter.textContent="Сохранение...",c.preventDefault();var i={name:x.value,link:A.value,likes:[],owner:{_id:I.userInfoData._id}};(function(n,r){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify(r)}).then(e).finally((function(){n.submitter.textContent="Создать"}))})(c,i).then((function(t){var e=n(t,r,O,o,I);L.prepend(e),a(k)})).catch((function(t){console.log(t)})).finally((function(){c.submitter.textContent="Создать"}))})),Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(e),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(e)]).then((function(t){var e,c,a=(c=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(e,c)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(e,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],u=a[1];I.userInfoData=i,I.cardsData=u,function(t){t.forEach((function(t){var e=n(t,r,O,o,I);L.append(e)}))}(u),function(t){p.textContent=t.name,_.textContent=t.about,y.setAttribute("style","background-image: url(".concat(t.avatar)),y.alt=t.name}(i)})).catch((function(t){console.log(t)}));b.addEventListener("click",(function(){s(h,j),c(v)})),h.addEventListener("submit",(function(n){n.preventDefault(),function(n,r){n.submitter.textContent="Сохранение...",function(n){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then(e)}(r).then((function(t){y.setAttribute("style","background-image: url(".concat(t.avatar)),a(v),h.reset()})).catch((function(t){console.log(t)})).finally((function(){n.submitter.textContent="Сохранить"}))}(n,h.elements.link.value)}))})();